<!DOCTYPE html>
<!--
* CoreUI - Free Bootstrap Admin Template
* @version v3.0.0
* @link https://coreui.io
* Copyright (c) 2020 creativeLabs Łukasz Holeczek
* Licensed under MIT (https://coreui.io/license)
-->

<html lang="en">
  <head>
    <base href="./../">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="description" content="CoreUI - Open Source Bootstrap Admin Template">
    <meta name="author" content="Łukasz Holeczek">
    <meta name="keyword" content="Bootstrap,Admin,Template,Open,Source,jQuery,CSS,HTML,RWD,Dashboard">
    <title>CoreUI Free Bootstrap Admin Template</title>
    <link rel="apple-touch-icon" sizes="57x57" href="assets/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="assets/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="assets/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="assets/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="assets/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="assets/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="assets/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="assets/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="assets/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
    <link rel="manifest" href="assets/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="assets/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <!-- Main styles for this application-->
    <link href="../css/dateTime/jquery.datetimepicker.css" rel="stylesheet" />
    <link href="../css/style.css" rel="stylesheet" />
    <style>
      .help-block{
        color: red;        
      }
    </style>
    <!-- Global site tag (gtag.js) - Google Analytics-->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-118965717-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];

      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      // Shared ID
      gtag('config', 'UA-118965717-3');
      // Bootstrap ID
      gtag('config', 'UA-118965717-5');
    </script>
    <link href="node_modules/@coreui/chartjs/dist/css/coreui-chartjs.css" rel="stylesheet">

    <script src="../js/jquery-3.5.0.js"></script>
    <script src="../js/dateTime/jquery.js"></script>
    <script src="../js/dateTime/jquery.datetimepicker.full.min.js"></script>
    
    <script type="text/javascript">
        function getUrlParameter(name) {
          name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
          var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
          var results = regex.exec(window.location.search);
          return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        };
          
        var bid = "";
        var globaldetail = null;

      $( document ).ready(function() {
          if (localStorage.getItem("token")==null){
            window.location.replace("http://127.0.0.1:3001/login.html");
          }                   
          $.datetimepicker.setLocale('en');
          // $('.datetimepicker').datetimepicker({ format: 'm/d/Y h:i A', timepicker: true });
          $('.datetimepicker').datetimepicker({ format: 'Y-m-d H:i:s', timepicker: true });
          $('.datepicker').datetimepicker({ format: 'm/d/Y', timepicker: false });
         
          bid = getUrlParameter('id');

          if (bid==null|| bid == ""){
            window.location.replace("http://127.0.0.1:3001/agent/index.html");
          }

          $.ajax({
            type: "GET",
            dataType: "json",    
            headers: {
              "content-type": "application/json",
              'Authorization': 'Token ' + localStorage.getItem("token")
            },
            
            url: "http://127.0.0.1:8000/agents/"+bid,
            data:'',
            success: function(response) {
              globaldetail = response;

              $("#id").val(response.id);
              $("#Name").val(response.name);
              $("#Description").val(response.description);
              $("#Path").val(response.path);
              $("#ScriptContent").val(response.script_content);
              $("#ScriptInputs").val(response.script_inputs);
              $("#Delay").val(response.delay);
              $("#Output").val(response.output);
              $("#Result").val(response.result);
              $("#StartTime").val((response.start_time).replace("T"," ").split("+")[0]);

              if(response.is_scheduled=="1"){
                $('#IsScheduled').prop('checked', true);
              }
               
            },
            error: function(result) {
              document.getElementById("msg_error_div").style.display="block";
              $("#msg_error").text(result["error"]);
              window.location.replace("http://127.0.0.1:3001/404.html");
            }
            
        });

        // -----------------------------------------

      });

    </script>

  </head>
  <body class="c-app">
    <div class="c-sidebar c-sidebar-dark c-sidebar-fixed c-sidebar-lg-show" id="sidebar">
      <div class="c-sidebar-brand d-lg-down-none">
        <svg class="c-sidebar-brand-full" width="118" height="46" alt="CoreUI Logo">
          <use xlink:href="assets/brand/coreui.svg#full"></use>
        </svg>
        <svg class="c-sidebar-brand-minimized" width="46" height="46" alt="CoreUI Logo">
          <use xlink:href="assets/brand/coreui.svg#signet"></use>
        </svg>
      </div>
      <ul class="c-sidebar-nav">
        <li class="c-sidebar-nav-item"><a class="c-sidebar-nav-link" href="dashboard.html">
            <svg class="c-sidebar-nav-icon">
              <use xlink:href="node_modules/@coreui/icons/sprites/free.svg#cil-speedometer"></use>
            </svg> Dashboard<span class="badge badge-info">NEW</span></a></li>

        <li class="c-sidebar-nav-title">Bulletin</li>
        <li class="c-sidebar-nav-item"><a class="c-sidebar-nav-link" href="bulletin/index.html">
            <svg class="c-sidebar-nav-icon">
              <use xlink:href="node_modules/@coreui/icons/sprites/free.svg#cil-drop1"></use>
            </svg> List </a></li>
            
        <li class="c-sidebar-nav-title">Agent</li>
        <li class="c-sidebar-nav-item"><a class="c-sidebar-nav-link" href="agent/index.html">
            <svg class="c-sidebar-nav-icon">
              <use xlink:href="node_modules/@coreui/icons/sprites/free.svg#cil-drop1"></use>
            </svg> List </a></li>

      </ul>
      <button class="c-sidebar-minimizer c-class-toggler" type="button" data-target="_parent" data-class="c-sidebar-minimized"></button>
    </div>
    <div class="c-wrapper c-fixed-components">
      <header class="c-header c-header-light c-header-fixed c-header-with-subheader">
        <button class="c-header-toggler c-class-toggler d-lg-none mfe-auto" type="button" data-target="#sidebar" data-class="c-sidebar-show">
          <svg class="c-icon c-icon-lg">
            <use xlink:href="node_modules/@coreui/icons/sprites/free.svg#cil-menu"></use>
          </svg>
        </button><a class="c-header-brand d-lg-none" href="#">
          <svg width="118" height="46" alt="CoreUI Logo">
            <use xlink:href="assets/brand/coreui.svg#full"></use>
          </svg></a>
        <button class="c-header-toggler c-class-toggler mfs-3 d-md-down-none" type="button" data-target="#sidebar" data-class="c-sidebar-lg-show" responsive="true">
          <svg class="c-icon c-icon-lg">
            <use xlink:href="node_modules/@coreui/icons/sprites/free.svg#cil-menu"></use>
          </svg>
        </button>
        <ul class="c-header-nav d-md-down-none">
          <li class="c-header-nav-item px-3"><a class="c-header-nav-link" href="#">Dashboard</a></li>
          <li class="c-header-nav-item px-3"><a class="c-header-nav-link" href="#">Users</a></li>
          <li class="c-header-nav-item px-3"><a class="c-header-nav-link" href="#">Settings</a></li>
        </ul>
        <ul class="c-header-nav ml-auto mr-4">
          <li class="c-header-nav-item d-md-down-none mx-2"><a class="c-header-nav-link" href="#">
              <svg class="c-icon">
                <use xlink:href="node_modules/@coreui/icons/sprites/free.svg#cil-bell"></use>
              </svg></a></li>
          <li class="c-header-nav-item d-md-down-none mx-2"><a class="c-header-nav-link" href="#">
              <svg class="c-icon">
                <use xlink:href="node_modules/@coreui/icons/sprites/free.svg#cil-list-rich"></use>
              </svg></a></li>
          <li class="c-header-nav-item d-md-down-none mx-2"><a class="c-header-nav-link" href="#">
              <svg class="c-icon">
                <use xlink:href="node_modules/@coreui/icons/sprites/free.svg#cil-envelope-open"></use>
              </svg></a></li>
          <li class="c-header-nav-item dropdown"><a class="c-header-nav-link" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
              <div class="c-avatar"><img class="c-avatar-img" src="assets/img/avatars/6.jpg" alt="user@email.com"></div>
            </a>
            <div class="dropdown-menu dropdown-menu-right pt-0">
              <div class="dropdown-header bg-light py-2"><strong>Account</strong></div><a class="dropdown-item" href="#">
                <svg class="c-icon mr-2">
                  <use xlink:href="node_modules/@coreui/icons/sprites/free.svg#cil-bell"></use>
                </svg> Updates<span class="badge badge-info ml-auto">42</span></a><a class="dropdown-item" href="#">
                <svg class="c-icon mr-2">
                  <use xlink:href="node_modules/@coreui/icons/sprites/free.svg#cil-envelope-open"></use>
                </svg> Messages<span class="badge badge-success ml-auto">42</span></a><a class="dropdown-item" href="#">
                <svg class="c-icon mr-2">
                  <use xlink:href="node_modules/@coreui/icons/sprites/free.svg#cil-task"></use>
                </svg> Tasks<span class="badge badge-danger ml-auto">42</span></a><a class="dropdown-item" href="#">
                <svg class="c-icon mr-2">
                  <use xlink:href="node_modules/@coreui/icons/sprites/free.svg#cil-comment-square"></use>
                </svg> Comments<span class="badge badge-warning ml-auto">42</span></a>
              <div class="dropdown-header bg-light py-2"><strong>Settings</strong></div><a class="dropdown-item" href="#">
                <svg class="c-icon mr-2">
                  <use xlink:href="node_modules/@coreui/icons/sprites/free.svg#cil-user"></use>
                </svg> Profile</a><a class="dropdown-item" href="#">
                <svg class="c-icon mr-2">
                  <use xlink:href="node_modules/@coreui/icons/sprites/free.svg#cil-settings"></use>
                </svg> Settings</a><a class="dropdown-item" href="#">
                <svg class="c-icon mr-2">
                  <use xlink:href="node_modules/@coreui/icons/sprites/free.svg#cil-credit-card"></use>
                </svg> Payments<span class="badge badge-secondary ml-auto">42</span></a><a class="dropdown-item" href="#">
                <svg class="c-icon mr-2">
                  <use xlink:href="node_modules/@coreui/icons/sprites/free.svg#cil-file"></use>
                </svg> Projects<span class="badge badge-primary ml-auto">42</span></a>
              <div class="dropdown-divider"></div><a class="dropdown-item" href="#">
                <svg class="c-icon mr-2">
                  <use xlink:href="node_modules/@coreui/icons/sprites/free.svg#cil-lock-locked"></use>
                </svg> Lock Account</a><a class="dropdown-item" href="#" id="btn_logout">
                <svg class="c-icon mr-2">
                  <use xlink:href="node_modules/@coreui/icons/sprites/free.svg#cil-account-logout"></use>
                </svg> Logout</a>
            </div>
          </li>
        </ul>
        <div class="c-subheader px-3">
          <!-- Breadcrumb-->
          <ol class="breadcrumb border-0 m-0">
            <li class="breadcrumb-item">Home</li>
            <li class="breadcrumb-item"><a href="#">Admin</a></li>
            <li class="breadcrumb-item active">Bulletins</li>
            <!-- Breadcrumb Menu-->
          </ol>
        </div>
      </header>
      <div class="c-body">
        <main class="c-main">
          <div class="container-fluid">
            <div class="fade-in">
              <div class="row">

              </div>
              <!-- /.row-->
              <div class="row">
                <div class="col-lg-12">
                  <div class="card">
                    <div class="card-header"><strong>Agent</strong> Form</div>
                    <div class="card-body">
                      <form class="form-horizontal" action="" method="post">
                        <div class="form-group row" >    
<!-- ----------------------------------------------------------- -->

<div class="alert alert-success col-lg-12" id="msg_success_div"  style="display: none;">
  <span id="msg_success" > success </span> 
</div>

<div class="alert alert-danger col-lg-12" id="msg_error_div"  style="display: none;">
  <span id="msg_error" > error </span>  
</div>

<!-- ----------------------------------------------------------- -->                          
                        </div>                         
                        
                        <div class="form-group row">
                          <label class="col-md-3 col-form-label" for="hf-Name">Name <span class="help-block">*</span></label>
                          <div class="col-md-9">
                            <input class="form-control" id="Name" type="text" name="Name" placeholder="Enter Name.." />
                            <span class="help-block" id="hb_Name" style="display: none;">Please enter your Name</span>
                          </div>
                        </div>

                        <div class="form-group row">
                          <label class="col-md-3 col-form-label" for="hf-Description">Description </label>
                          <div class="col-md-9">
                            <textarea  class="form-control" id="Description" name="Description" rows="5" placeholder="Enter Description.." ></textarea>                            
                          </div>
                        </div>
                        
                        <div class="form-group row">
                          <label class="col-md-3 col-form-label" for="hf-Path">Path <span class="help-block">*</span></label>
                          <div class="col-md-9">
                            <input class="form-control" id="Path" type="text" name="Path" placeholder="Enter Path.." />
                            <span class="help-block" id="hb_Path" style="display: none;">Please enter your Path</span>
                          </div>
                        </div>

                        <div class="form-group row">
                          <label class="col-md-3 col-form-label" for="hf-ScriptContent">Script Content <span class="help-block">*</span></label>
                          <div class="col-md-9">
                            <textarea  class="form-control" id="ScriptContent" name="ScriptContent" rows="5" placeholder="Enter Script Content.." ></textarea>
                            <span class="help-block" id="hb_ScriptContent" style="display: none;">Please enter your Script Content</span>
                          </div>
                        </div>
                        
                        <div class="form-group row">
                          <label class="col-md-3 col-form-label" for="hf-ScriptInputs">Script Inputs </label>
                          <div class="col-md-9">
                            <input class="form-control" id="ScriptInputs" type="text" name="ScriptInputs" placeholder="Enter Script Inputs.." />
                            
                          </div>
                        </div>

                        <div class="form-group row">
                          <label class="col-md-3 col-form-label" for="hf-Delay"> Delay <span class="help-block">*</span></label>
                          <div class="col-md-9">
                            <input class="form-control" id="Delay" type="text" name="Delay" placeholder="Enter Delay.." />
                            <span class="help-block" id="hb_Delay" style="display: none;">Please enter your Delay</span>
                          </div>
                        </div>

                        <div class="form-group row">
                          <label class="col-md-3 col-form-label" for="hf-Output">Output </label>
                          <div class="col-md-9">
                            <textarea  class="form-control" id="Output" name="Output" rows="5" placeholder="Enter Script Output.." ></textarea>
                          </div>
                        </div>

                        <div class="form-group row">
                          <label class="col-md-3 col-form-label" for="hf-Result">Result </label>
                          <div class="col-md-9">
                            <textarea  class="form-control" id="Result" name="Result" rows="5" placeholder="Enter Result.." ></textarea>
                          </div>
                        </div>

                        <div class="form-group row">
                          <label class="col-md-3 col-form-label" for="hf-StartTime">Start Time <span class="help-block">*</span> </label>
                          <div class="col-md-9">
                            <input class="form-control datetimepicker" id="StartTime" type="text" name="StartTime" placeholder="Enter BeginTime.." >
                            <span class="help-block" id="hb_StartTime" style="display: none;">Please enter your StartTime</span>
                          </div>
                        </div>
                        
                        <div class="form-group row">
                          <label class="col-md-3 col-form-label" for="hf-CaseID">Is Scheduled</label>
                          <div class="col-md-9">
                            <label class="c-switch c-switch-label c-switch-danger">
                              <input class="c-switch-input" type="checkbox" id="IsScheduled"><span class="c-switch-slider" data-checked="On" data-unchecked="Off"></span>
                            </label>
                          </div>
                        </div>                       


                        

                      </form>
                    </div>
                    <div class="card-footer">
                      <button class="btn btn-primary" type="submit" id="btn_save"> Save </button>
                      <a href="agent/index.html" class="btn btn-secondary" > Back to list</a>
                    </div>
                  </div>

                  
                </div>
              </div>
              

              <!-- /.card-->
              
              
            </div>
          </div>
        </main>
        <footer class="c-footer">
          <div><a href="https://coreui.io">CoreUI</a> &copy; 2020 creativeLabs.</div>
          <div class="ml-auto">Powered by&nbsp;<a href="https://coreui.io/">CoreUI</a></div>
        </footer>
      </div>
    </div>
    <!-- CoreUI and necessary plugins-->
    <script src="node_modules/@coreui/coreui/dist/js/coreui.bundle.min.js"></script>
    <!--[if IE]><!-->
    <script src="node_modules/@coreui/icons/js/svgxuse.min.js"></script>
    <!--<![endif]-->
    <!-- Plugins and scripts required by this view-->
    <script src="node_modules/@coreui/chartjs/dist/js/coreui-chartjs.bundle.js"></script>
    <script src="node_modules/@coreui/utils/dist/coreui-utils.js"></script>
    <script src="../js/main.js"></script>

    <script src="../js/jquery-3.5.0.js"></script>
    <script src="../js/moment.js"></script>
    <script src="../js/dateTime/jquery.js"></script>
    <script src="../js/dateTime/jquery.datetimepicker.full.min.js"></script>

    <script type="text/javascript"> 
      $("#btn_logout").click(function(e) {
        e.preventDefault();
        localStorage.removeItem("token");
        localStorage.clear();
        window.location.replace("http://127.0.0.1:3001/login.html");
      });      

      $("#btn_save").click(function(e) {
          e.preventDefault();  
          var datetimenow = moment().format();
          
          var name = $("#Name").val(); 
          var description = $("#Description").val();
          var path = $("#Path").val();
          var script_content = $("#ScriptContent").val();
          var script_inputs = $("#ScriptInputs").val();
          var delay = $("#Delay").val();
          var output = $("#Output").val();
          var result = $("#Result").val();
          var start_time = $("#StartTime").val().replace(" ", "T");
          var is_scheduled = $('#IsScheduled:checked').val() ? 1 : 0;
          var is_deleted = 0;                
          
          if(start_time==""){
            document.getElementById("hb_StartTime").style.display="block";
          }
          if(name==""){
            document.getElementById("hb_Name").style.display="block";
          }
          if(path==""){
            document.getElementById("hb_Path").style.display="block";
          }
          if(script_content==""){
            document.getElementById("hb_ScriptContent").style.display="block";
          }
          if(delay==""){
            document.getElementById("hb_Delay").style.display="block";
          }

          if(start_time !="" && name !="" &&  path !="" &&  script_content !="" &&  delay !=""){
          $.ajax({
            type: "PUT",
            dataType: "json",
            headers: {
              "content-type": "application/json",
              'Authorization': 'Token ' + localStorage.getItem("token")              
            },
            
            url: "http://127.0.0.1:8000/agents/" + bid + "/update/",
            data: JSON.stringify({                       
              'name' : name, 
              'description' : description,
              'path' : path, 
              'script_content' : script_content,
              'script_inputs': script_inputs,
              'delay' : delay, 
              'output' : output,
              'result' : result, 
              'start_time' :start_time, 
              'is_scheduled' : is_scheduled,
              'is_deleted': is_deleted             
            }),
            success: function(response) {
              document.getElementById("msg_success_div").style.display="block";
              $("#msg_success").text(response.message);               
            },
            error: function(result) {
              document.getElementById("msg_error_div").style.display="block";
              $("#msg_error").text(result["error"]);
            }
          }); 
        }  
        });
    </script>
  </body>
</html>
